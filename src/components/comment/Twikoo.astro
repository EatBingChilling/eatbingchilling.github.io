---
const config = {
  el: "#comment",
  path: Astro.props.path,
};
---
<div id="comment">
  <div class="text-center text-gray-500 dark:text-gray-400 p-8">
    <p>评论区加载中...</p>
    <p class="text-sm mt-2">如果长时间无法显示，请尝试刷新页面。</p>
  </div>
</div>
<script is:inline define:vars={{ config }}>
  function initTwikoo() {
    const commentContainer = document.getElementById('comment');
    if (!commentContainer) return;

    if (window.twikoo) {
      window.twikoo.init({
        ...config,
        envId: "https://twikoo.phb1og.fun",
        lang: 'zh-TW',
      });
      return;
    }

    const script = document.createElement('script');
    script.id = 'twikoo-script';
    script.src = '/twikoo/twikoo.all.min.js';
    script.defer = true;

    script.onload = () => {
      window.twikoo?.init({
        ...config,
        envId: "https://twikoo.phb1og.fun",
        lang: 'zh-TW',
      });
    };

    document.head.appendChild(script);
  }

  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTwikoo);
  } else {
    initTwikoo(); // 已加载完成，直接执行
  }

 
  document.addEventListener('astro:page-load', initTwikoo);
</script>
